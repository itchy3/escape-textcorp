<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Escape from TextCorp</title>
<style>
body{font-family:"Noto Sans KR",sans-serif;background:#0b0e17;color:#eaeef9;margin:0;display:flex;justify-content:center;align-items:center;min-height:100vh}
#container{width:90%;max-width:800px;padding:20px}
#log{background:#101828;border-radius:12px;padding:20px;height:480px;overflow-y:auto;white-space:pre-wrap}
#inputBox{display:flex;margin-top:10px;gap:10px}
#msg{flex:1;padding:10px;border-radius:8px;border:1px solid #2b324d;background:#1a2034;color:white}
button{padding:10px 14px;border:0;border-radius:8px;background:#3a5bea;color:white;cursor:pointer}
button:hover{background:#536ffc}
</style>
</head>
<body>
<div id="container">
<h2>ğŸ® Escape from TextCorp v30</h2>
<div id="log">ê²Œì„ì„ ì‹œì‘í•˜ë ¤ë©´ "ì‹œì‘"ì„ ì…ë ¥í•˜ì„¸ìš”.</div>
<div id="inputBox">
  <input id="msg" type="text" placeholder="ì…ë ¥..." />
  <button id="send">ë³´ë‚´ê¸°</button>
</div>
</div>
<script>
const log = document.getElementById("log");
const input = document.getElementById("msg");
const send = document.getElementById("send");
let history = [];

function append(text, who='ai'){
  const div = document.createElement('div');
  div.style.marginTop = '8px';
  div.innerHTML = who==='user' ? `<b>ğŸ§â€â™‚ï¸ë‹¹ì‹ :</b> ${text}` : `<b>ğŸ¤– AI:</b> ${text}`;
  log.appendChild(div);
  log.scrollTop = log.scrollHeight;
}

async function sendMessage(){
  const text = input.value.trim();
  if(!text) return;
  append(text,'user');
  input.value='';
  const res = await fetch('/api/chat', {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({message:text, history})
  });
  const data = await res.json();
  append(data.reply);
  history.push({role:'user',content:text});
  history.push({role:'assistant',content:data.reply});
}

send.onclick = sendMessage;
input.addEventListener('keydown', e=>{if(e.key==='Enter')sendMessage()});
</script>
</body>
</html>
